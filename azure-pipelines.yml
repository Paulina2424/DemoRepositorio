stages:
  - stage: Build
    jobs:
      - job: BuildMS
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - script: chmod 777 gradlew
            name: permisos
          - script: ./gradlew build
            name: build
  - stage: Docker image
    displayName: Build and push stage
    jobs:  
    - job: Build
      displayName: Build job
      pool:
        vmImage: $(vmImage)
      steps:
      - task: Docker@2
        displayName: Build and push an image to container registry
        inputs:
          command: buildAndPush
          repository: $(imageRepository)
          dockerfile: $(dockerfilePath)
          containerRegistry: $(dockerRegistryServiceConnection)
          tags: |
            $(tag)
       
